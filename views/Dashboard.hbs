<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>The Wiki Game | Dashboard</title>
    <script src="jquery_3.3.1.js"></script>
    <script src="modal.js" defer></script>
    <script src="lead.js" defer></script>
    <link rel="stylesheet" href="dashboard.css">
    {{!-- <script>
        Handlebars.registerHelper('comp', function (count) {
            return count + 1; // where cnt will be calculated
        })
    </script> --}}
    <script>
        function compare(a, b) {
            const timeA = a.time
            const timeB = b.time

            let comparison = 0;
            if(timeA > timeB) {
                comparison = 1
            } else if (timeA < timeB) {
                comparison = -1
            }

            return comparison
        }
    </script>
</head>

<body>


    <div class="navbar">
        <img src="the_wiki_game_logo_smaller_spaces.png" alt="Logo Failed to Load"
            style="width: 7.5vw; height:3vw; top: 0vw; cursor: pointer;" onclick="window.location.href = '/dashboard'">
        <ul class="navul">
            <li class="navlink" style="color: #201a06; font-weight:bold" onclick="window.location.href = '/dashboard'">
                HOME</li>
            <li class="navlink">|</li>
            <li class="navlink" onclick="window.location.href = '/leaderboard'">LEADERBOARD</li>
            <li class="navlink">|</li>
            <li class="navlink" id="profile">{{nav}}</li>
        </ul>
    </div>

    <div id="myModal" class="modal">
        <!-- Modal content -->
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="contents">
                <p style="font-family: 'Montserrat Light'; font-weight:bold; font-size: 2vw;">Want to record your
                    progress?</p>
                <button class="login_btn" id="loginbtn" onclick="window.location.href = '/'">LOGIN</button>
                <p style="font-size:2vw; position:relative; top: 7vw; font-family: 'Montserrat Light';">OR</p>
                <a class="signup_link" id="signuplink" onclick="window.location.href = '/signup'">SIGN UP</a>
            </div>
        </div>

    </div>

    <div class="container">
        <div class="ready">
            <div class="curr_title">
                <p class="curr">WITH A TWIST!</p>
            </div>
            <div class="blurb">
                <div class="format">
                    <p>
                        <b style="font-size: 2vw">TRAVERSE THE WORLD OF</b> <br>
                        <b style="font-size: 2vw"> WIKIPEDIA</b> <br><br>
                        YOUR GOAL: Get from the starting Wikipedia article to the ending article by clicking on links. <br>
                    </p>
                </div>
            </div>
            {{!-- <ul class="dets">
                <li class="starting">
                    <ul class="start">
                        <li class="st">START:</li>
                        <li class="st_word" id="startword">Jeon Jungkook</li>
                    </ul>
                </li>
                <li class="targeting">
                    <ul class="target">
                        <li class="tg">TARGET:</li>
                        <li class="tg_word" id="targetword">Erika Y Chan</li>
                    </ul>
                </li>
            </ul> --}}
            <button class="start_btn" onclick="window.location.href = '/game'">START</button>
        </div>

        <div class="leaderboard">
            <div class="headers">
                <button class="day_hd" id="day">DAY</button>
                <button class="week_hd" id="week">MONTH</button>
                <button class="all_time_hd" id="all_time">ALL TIME</button>
            </div>     
            <div class="content">
                <div class="content_day" id="day_dets">
                    <p class="top_5">TOP 5</p>
                    {{!-- {{#each leaderboard}} --}}
                    {{!-- <div class="first" style="background-color: #fdf7db; height: 5vw;">
                        <ul class="details">
                            <li class="number" data-id="{{_id}}_key">{{@key}}.</li>
                            <li class="name" id="user_first">{{username}}</li>
                            <li class="dash">-</li>
                            <li class="points" data-id="{{_id}}"></li>
                            <script>
                                $("li[data-id={{_id}}]").text(Math.floor({{ time }} / 1000 / 60) + " min " + Math.round({{ time }}/1000%60) + " sec")
                                            $("li[data-id={{_id}}_key]").text(({{@key}} + 1) + ".")
                            </script>
                        </ul>
                    </div> --}}
                    {{!-- {{/each}} --}}
                </div>

                <div class="content_week" id="week_dets">
                    <p class="top_5">TOP 5</p>
                    {{!-- {{#each leaderboard}}
                    <div class="first" style="background-colo   r: #fdf7db; height: 5vw;">
                        <ul class="details">
                            <li class="number">{{@key}}: {{this}}.</li>
                            <li class="name" id="user_first">{{username}}</li>
                            <li class="dash">-</li>
                            <li class="points" id="time_first">{{time}}</li>
                        </ul>
                    </div>
                    {{/each}} --}}
                </div>
                
                <div class="content_all_time" id="all_time_dets">
                    <p class="top_5">TOP 5</p>
                    {{!-- {{#each leaderboard}}
                    <div class="first" style="background-color: #fdf7db; height: 5vw;">
                        <ul class="details">
                            <li class="number">{{@key}}: {{this}}.</li>
                            <li class="name" id="user_first">{{username}}</li>
                            <li class="dash">-</li>
                            <li class="points" id="time_first">{{time}}</li>
                        </ul>
                    </div>
                    {{/each}} --}}
                </div>
                <script>

                    $("#day").click(()=>{
                        $("#day_dets").css("display", "flex")
                        $("#week_dets").css("display", "none")
                        $("#all_time_dets").css("display", "none")
                    })
                    $("#week").click(()=>{
                        $("#day_dets").css("display", "none")
                        $("#week_dets").css("display", "flex")
                        $("#all_time_dets").css("display", "none")
                    })
                    $("#all_time").click(()=>{
                        $("#day_dets").css("display", "none")
                        $("#week_dets").css("display", "none")
                        $("#all_time_dets").css("display", "flex")
                    })

                    var x = []
                    {{!-- let temp = new Date() --}}
                    var y
                    {{#each leaderboard}}
                    let abc{{_id}} = new Date()
                    abc{{_id}}.setTime({{date}})
                    y = ("{{path}}").split(",")
                    x.push({
                        username: "{{username}}",
                        time: {{time}},
                        date: abc{{_id}},
                        path: y
                    })
                    {{/each}}
                    x.sort(compare)
                    console.log(x)
                    let now = new Date()
                    var daily = []
                    for(var i = 0; i < x.length; i++){
                        if(x[i].date.getDate() == now.getDate() && x[i].date.getFullYear() == now.getFullYear()) {
                            daily.push(x[i])
                        }
                    }
                    console.log(daily)
                    var monthly = []
                    for(var i = 0; i < x.length; i++){
                        if(x[i].date.getMonth() == now.getMonth() && x[i].date.getFullYear() == now.getFullYear()) {
                            monthly.push(x[i])
                        }
                    }
                    console.log(monthly)

                    for(var i = 0; i < daily.length && i < 5; i++) {
                        var container, ul, li1, li2, li3, li4
                        container = document.createElement("div")
                        container.className = "first"
                        $(container).css("background-color", "#fdf7db")
                        $(container).css("height", "5vw")
                        $("#day_dets").append(container)

                        ul = document.createElement("ul")
                        ul.className = "details"
                        container.append(ul)

                        li1 = document.createElement("li")
                        li1.className = "number"
                        $(li1).text((i + 1) + ".")
                        ul.append(li1)

                        li2 = document.createElement("li")
                        li2.className = "name"
                        $(li2).text(daily[i].username)
                        ul.append(li2)

                        li3 = document.createElement("li")
                        li3.className = "dash"
                        $(li3).text("-")
                        ul.append(li3)

                        li4 = document.createElement("li")
                        li4.className = "points"
                        $(li4).text(Math.floor(daily[i].time / 1000 / 60) + " min " + Math.round(daily[i].time/1000%60) + " sec")
                        ul.append(li4)
                    }

                    for(var i = 0; i < monthly.length && i < 5; i++) {
                        var container, ul, li1, li2, li3, li4
                        container = document.createElement("div")
                        container.className = "first"
                        $(container).css("background-color", "#fdf7db")
                        $(container).css("height", "5vw")
                        $("#week_dets").append(container)

                        ul = document.createElement("ul")
                        ul.className = "details"
                        container.append(ul)

                        li1 = document.createElement("li")
                        li1.className = "number"
                        $(li1).text((i + 1) + ".")
                        ul.append(li1)

                        li2 = document.createElement("li")
                        li2.className = "name"
                        $(li2).text(monthly[i].username)
                        ul.append(li2)

                        li3 = document.createElement("li")
                        li3.className = "dash"
                        $(li3).text("-")
                        ul.append(li3)

                        li4 = document.createElement("li")
                        li4.className = "points"
                        $(li4).text(Math.floor(monthly[i].time / 1000 / 60) + " min " + Math.round(monthly[i].time/1000%60) + " sec")
                        ul.append(li4)
                    }

                    for(var i = 0; i < x.length && i < 5; i++) {
                        var container, ul, li1, li2, li3, li4
                        container = document.createElement("div")
                        container.className = "first"
                        $(container).css("background-color", "#fdf7db")
                        $(container).css("height", "5vw")
                        $("#all_time_dets").append(container)

                        ul = document.createElement("ul")
                        ul.className = "details"
                        container.append(ul)

                        li1 = document.createElement("li")
                        li1.className = "number"
                        $(li1).text((i + 1) + ".")
                        ul.append(li1)

                        li2 = document.createElement("li")
                        li2.className = "name"
                        $(li2).text(x[i].username)
                        ul.append(li2)

                        li3 = document.createElement("li")
                        li3.className = "dash"
                        $(li3).text("-")
                        ul.append(li3)

                        li4 = document.createElement("li")
                        li4.className = "points"
                        $(li4).text(Math.floor(x[i].time / 1000 / 60) + " min " + Math.round(x[i].time/1000%60) + " sec")
                        ul.append(li4)
                    }
                </script>
            </div>
        </div>
    </div>


    <form action="edit" id="userform">
        <input type="hidden" name="id" id="editid">
    </form>
</body>

</html>